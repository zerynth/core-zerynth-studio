<script>

var DeviceInfoModal = {
  dev: null,
  __fill: function(data){
    DeviceInfoModal.dev = data
    if (data.flash_erasable){
      $("#eraseflash").show();
    }
    else{
      $("#eraseflash").hide();
    }
    if (data.operating_modes) {
      if ($("#deviceinfo_modal .putmode-btns-span button").length == 0)
        $.each(data.operating_modes, function(index, mode) {
          $("#deviceinfo_modal .putmode-btns-span").append($('<button type="button" class="btn btn-danger" onclick="DeviceInfoModal.put_mode(\'' + mode + '\')">' + mode.toUpperCase() + ' mode</button>'));
        })
    }
    else {
      $("#deviceinfo_modal .putmode-btns-span").html("");
    }
    $("#deviceinfo_modal_table").html($.templates("#deviceinfo_modal_rows").render(data))
  },
  __show: function(){
    $("#deviceinfo_modal").modal()
  },
  __hide: function(){
    $("#deviceinfo_modal").modal("hide")
  },
  forget: function(){
    if (DeviceInfoModal.dev && DeviceInfoModal.dev.alias){
      Z.log("Forgetting "+DeviceInfoModal.dev.alias)
      ZDevices.unset_alias(DeviceInfoModal.dev)
    } else {
      Z.log("Can't forget this device")
    }
    DeviceInfoModal.__hide()
  },
  erase_flash: function(){
    if (DeviceInfoModal.dev && DeviceInfoModal.dev.alias){
      var confirm = bootbox.confirm({
            title: "Erasing Memory Flash",
            message: "Do you want to erase completely the memory flash of your device?<br>Note: all data stored will be deleted!",
            buttons: {
                cancel: {
                    label: '<i class="fa fa-times"></i> Cancel'
                },
                confirm: {
                    label: '<i class="fa fa-check"></i> Confirm'
                }
            },
            callback: function (result) {
                console.log(result)
                if (result==false){
                    confirm.modal("hide")
                } else {
                    ZDevices.erase_flash(DeviceInfoModal.dev)
                }
            }
        });
    } else {
      Z.log("Can't erase flash")
    }
    DeviceInfoModal.__hide()
  },
  put_mode: function(mode){
    if (DeviceInfoModal.dev && DeviceInfoModal.dev.alias){
      Z.log("Putting in " + mode.toUpperCase() + " mode")
      ZDevices.put_mode(DeviceInfoModal.dev, mode)
    } else {
      Z.log("Cannot put this device in selected mode")
    }
    DeviceInfoModal.__hide()
  },
}

</script>

<script id="deviceinfo_modal_rows" type="text/x-jsrender">
<tr>
  <td style="width:150px"><b>Name</b></td><td>{{:name}}</td>
</tr>
<tr>
  <td style="width:150px"><b>Architecture</b></td><td>{{:architecture}}</td>
</tr>
<tr>
  <td style="width:150px"><b>Model</b></td><td>{{:chip_manifacturer}}&nbsp;{{:chip_model}}</td>
</tr>
<tr>
  <td style="width:150px"><b>Flash</b></td><td>{{:flash}}</td>
</tr>
<tr>
  <td style="width:150px"><b>Ram</b></td><td>{{:ram}}</td>
</tr>
<tr>
  <td style="width:150px"><b>ZTC Alias</b></td><td>{{:alias || "None"}}</td>
</tr>
<tr>
  <td style="width:150px"><b>Port</b></td><td>{{:port || "None"}}</td>
</tr>
<tr>
  <td style="width:150px"><b>Disk</b></td><td>{{:disk || "None"}}</td>
</tr>
<tr>
  <td style="width:150px"><b>Signature</b></td><td>{{:vid}}:{{:pid}}:{{:sid}}</td>
</tr>
</script>

<div class="modal fade" id="deviceinfo_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          <span class="pficon pficon-close"></span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Device Info</h4>
      </div>
      <div class="modal-body">
        <table class="table table-striped table-bordered" id="deviceinfo_modal_table" style="max-height: 500px;padding:4px">
        </table>
        <div class="alert alert-danger" style="display:none">
          <span class="pficon pficon-error-circle-o" ></span><p id="deviceinfo_error"></p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" id="eraseflash" class="btn btn-danger" onclick="DeviceInfoModal.erase_flash()">Erase Flash</button>
        <span class="putmode-btns-span"></span>
        <button type="button" class="btn btn-warning" onclick="DeviceInfoModal.forget()">Forget</button>
        <button type="button" class="btn btn-primary" onclick="DeviceInfoModal.__hide()">OK</button>
      </div>
    </div>
  </div>
</div>